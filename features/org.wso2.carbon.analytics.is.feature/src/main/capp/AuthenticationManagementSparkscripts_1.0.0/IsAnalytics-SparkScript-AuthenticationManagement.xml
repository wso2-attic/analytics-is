<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Analytics>
    <Name>IsAnalytics-SparkScript-AuthenticationManagement</Name>
    <Script>
        CREATE TEMPORARY TABLE rawAnalyticsData USING CarbonAnalytics OPTIONS (tableName "ORG_WSO2_IS_ANALYTICS_STREAM_OVERALLAUTHENTICATION", schema "contextId STRING,eventId STRING,authenticationSuccess BOOLEAN,userName STRING,userStoreDomain STRING,tenantDomain STRING,remoteIp STRING,region STRING,inboundAuthType STRING,serviceProvider STRING,rememberMeEnabled BOOLEAN,forceAuthEnabled BOOLEAN,passiveAuthEnabled BOOLEAN,rolesCommaSeperated STRING,authenticationStep STRING,identityProvider STRING,authStepSuccess BOOLEAN,stepAuthenticator STRING,isFirstLogin BOOLEAN,identityProviderType STRING,_timestamp LONG", incrementalParams "rawAnalyticsData, SECOND", mergeSchema "false");

        CREATE TEMPORARY TABLE rawAnalyticsDataDuplicate USING CarbonAnalytics OPTIONS (tableName "ORG_WSO2_IS_ANALYTICS_STREAM_OVERALLAUTHENTICATION", schema "contextId STRING,eventId STRING,authenticationSuccess BOOLEAN,userName STRING,userStoreDomain STRING,tenantDomain STRING,remoteIp STRING,region STRING,inboundAuthType STRING,serviceProvider STRING,rememberMeEnabled BOOLEAN,forceAuthEnabled BOOLEAN,passiveAuthEnabled BOOLEAN,rolesCommaSeperated STRING,authenticationStep STRING,identityProvider STRING,authStepSuccess BOOLEAN,stepAuthenticator STRING,isFirstLogin BOOLEAN,identityProviderType STRING,_timestamp LONG", incrementalParams "rawAnalyticsDataDuplicate, SECOND", mergeSchema "false");

        INSERT INTO TABLE rawAnalyticsDataDuplicate SELECT contextId, eventId, authenticationSuccess, userName, userStoreDomain, tenantDomain,remoteIp, getCountry(remoteIp) as region,inboundAuthType,serviceProvider, rememberMeEnabled, forceAuthEnabled, passiveAuthEnabled,rolesCommaSeperated,authenticationStep,identityProvider,authStepSuccess,stepAuthenticator,isFirstLogin,identityProviderType,_timestamp  FROM rawAnalyticsData;

        INCREMENTAL_TABLE_COMMIT rawAnalyticsData;
    </Script>
    <CronExpression>0 0/5 * * * ?</CronExpression>
</Analytics>